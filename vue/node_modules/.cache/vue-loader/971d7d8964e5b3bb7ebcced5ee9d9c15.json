{"remainingRequest":"/home/Nico/Github/MagicLink/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/Nico/Github/MagicLink/vue/src/views/login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/Nico/Github/MagicLink/vue/src/views/login.vue","mtime":1589507531235},{"path":"/home/Nico/Github/MagicLink/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/Nico/Github/MagicLink/vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/Nico/Github/MagicLink/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/Nico/Github/MagicLink/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/Nico/Github/MagicLink/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBsb2dpbl9lbnRlciBmcm9tICJAL2NvbXBvbmVudHMvbG9naW5fZW50ZXIudnVlIgppbXBvcnQgbG9naW5fd2FpdGluZyBmcm9tICJAL2NvbXBvbmVudHMvbG9naW5fd2FpdGluZy52dWUiCmltcG9ydCB7IGdycGMgfSBmcm9tICJAaW1wcm9iYWJsZS1lbmcvZ3JwYy13ZWIiOwppbXBvcnQgeyBMb2dpbiB9IGZyb20gIi4uL2xvZ2luZ1JQQy9sb2dpbl9wYl9zZXJ2aWNlIjsgLy9zZXJ2aWNlCmltcG9ydCB7IGxvZ2luSW5mbywgand0fSBmcm9tICIuLi9sb2dpbmdSUEMvbG9naW5fcGIiOyAvL3R5cGUKaW1wb3J0IHJvdXRlciBmcm9tICIuLi9yb3V0ZXIiCmltcG9ydCBWdWUgZnJvbSAidnVlIgpjb25zdCBTdGF0ZSA9IHsKICAgIElkbGU6IDEsCiAgICBXYWl0aW5nOiAyLAp9CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJsb2dpbiIsCiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgbG9naW5fZW50ZXIsCiAgICAgICAgbG9naW5fd2FpdGluZywKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMuaXNMb2dnZWRJbigpOwogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY3VycmVudFN0YXRlOiBTdGF0ZS5JZGxlLAogICAgICAgICAgICBTdGF0ZSwKICAgICAgICAgICAgcmVzcG9uY2U6IiIsCiAgICAgICAgICAgIGVtYWlsOiIiLAogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgbG9naW4ocGFzc2VkRW1haWwpIHsKICAgICAgICAgICAgdGhpcy5lbWFpbCA9IHBhc3NlZEVtYWlsCiAgICAgICAgICAgIGNvbnN0IHNlbmRpbmdFbWFpbCA9IG5ldyBsb2dpbkluZm8oKTsKICAgICAgICAgICAgc2VuZGluZ0VtYWlsLnNldEVtYWlsKHBhc3NlZEVtYWlsKTsKICAgICAgICAgICAgc2VuZGluZ0VtYWlsLnNldEtleSgxKTsKCiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gU3RhdGUuV2FpdGluZzsKICAgICAgICAgICAgZ3JwYy51bmFyeShMb2dpbi5sb2dpbiwgewogICAgICAgICAgICAgICAgcmVxdWVzdDogc2VuZGluZ0VtYWlsLAogICAgICAgICAgICAgICAgaG9zdDogdGhpcy4kaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBvbkVuZDogcmVzID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHN0YXR1cywgc3RhdHVzTWVzc2FnZSwgaGVhZGVycywgbWVzc2FnZSwgdHJhaWxlcnMgfSA9IHJlczsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBncnBjLkNvZGUuT0sgJiYgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiand0IiwgbWVzc2FnZS50b09iamVjdCgpLmp3dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFZ1ZS5wcm90b3R5cGUuJHVzZXIgPSB0aGlzLmVtYWlsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlci5wdXNoKHtwYXRoOiAnLyd9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInN0YXR1czoiLCBzdGF0dXMsIHN0YXR1c01lc3NhZ2UsIGhlYWRlcnMsIG1lc3NhZ2UsIHRyYWlsZXJzKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbmNlID0gIllvdSdyZSBsaW5rIGlzIGV4cGlyZWQgdHJ5IGFnYWluIgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZSA9IFN0YXRlLklkbGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgaXNMb2dnZWRJbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxldCBsb2NhbEpXVCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJqd3QiKQoKICAgICAgICAgICAgY29uc3QgcmVxID0gbmV3IGp3dCgpCiAgICAgICAgICAgIHJlcS5zZXRKd3QobG9jYWxKV1QpCiAgICAgICAgICAgIGdycGMudW5hcnkoTG9naW4uaXNMb2dnZWRJbiwgewogICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxLAogICAgICAgICAgICAgICAgaG9zdDogdGhpcy4kaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBvbkVuZDogcmVzID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHN0YXR1cywgc3RhdHVzTWVzc2FnZSwgaGVhZGVycywgbWVzc2FnZSwgdHJhaWxlcnMgfSA9IHJlczsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBncnBjLkNvZGUuT0sgJiYgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXIucHVzaCh7cGF0aDogJy8nfSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJzdGF0dXM6Iiwgc3RhdHVzLCBzdGF0dXNNZXNzYWdlLCBoZWFkZXJzLCBtZXNzYWdlLCB0cmFpbGVycykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfSwKfQo="},{"version":3,"sources":["login.vue"],"names":[],"mappings":";;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"container\">\n        <div class=\"containerInner\">\n        <login_enter v-on:email=\"login\" v-if=\"currentState == State.Idle\"/>\n        <login_waiting v-bind:email=email v-if=\"currentState == State.Waiting\"/>\n        <p v-if=\"currentState == State.Idle\">{{responce}}</p>\n        </div>\n    </div>\n</template>\n\n<script>\nimport login_enter from \"@/components/login_enter.vue\"\nimport login_waiting from \"@/components/login_waiting.vue\"\nimport { grpc } from \"@improbable-eng/grpc-web\";\nimport { Login } from \"../logingRPC/login_pb_service\"; //service\nimport { loginInfo, jwt} from \"../logingRPC/login_pb\"; //type\nimport router from \"../router\"\nimport Vue from \"vue\"\nconst State = {\n    Idle: 1,\n    Waiting: 2,\n}\nexport default {\n    name: \"login\",\n    components: {\n        login_enter,\n        login_waiting,\n    },\n    created() {\n        this.isLoggedIn();\n    },\n    data() {\n        return {\n            currentState: State.Idle,\n            State,\n            responce:\"\",\n            email:\"\",\n        }\n    },\n    methods: {\n        login(passedEmail) {\n            this.email = passedEmail\n            const sendingEmail = new loginInfo();\n            sendingEmail.setEmail(passedEmail);\n            sendingEmail.setKey(1);\n\n            this.currentState = State.Waiting;\n            grpc.unary(Login.login, {\n                request: sendingEmail,\n                host: this.$hostname,\n                onEnd: res => {\n                    const { status, statusMessage, headers, message, trailers } = res;\n                    if (status === grpc.Code.OK && message) {\n                        localStorage.setItem(\"jwt\", message.toObject().jwt);\n                        Vue.prototype.$user = this.email\n                        router.push({path: '/'})\n                    } else {\n                    console.log(\"status:\", status, statusMessage, headers, message, trailers)\n                        this.responce = \"You're link is expired try again\"\n                        this.currentState = State.Idle;\n                    }\n                }\n            })\n        },\n        isLoggedIn: function() {\n            let localJWT = localStorage.getItem(\"jwt\")\n\n            const req = new jwt()\n            req.setJwt(localJWT)\n            grpc.unary(Login.isLoggedIn, {\n                request: req,\n                host: this.$hostname,\n                onEnd: res => {\n                    const { status, statusMessage, headers, message, trailers } = res;\n                    if (status === grpc.Code.OK && message) {\n                        router.push({path: '/'})\n                    } else {\n                       console.log(\"status:\", status, statusMessage, headers, message, trailers)\n                    }\n                }\n            })\n        }\n    },\n}\n</script>\n\n\n"]}]}